<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ¤– Ø§Ù„ØªØ´Ø§ØªØ¨ÙˆØª Ø§Ù„ØªÙØ§Ø¹Ù„ÙŠ Ø§Ù„ÙØ§Ø¦Ù‚ - Ù…Ø´Ø±ÙˆØ¹ ØªØ®Ø±Ø¬</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', 'Segoe UI', Tahoma, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow-x: hidden;
            position: relative;
        }

        /* Ø®Ù„ÙÙŠØ© Ù†ÙŠÙˆÙ†ÙŠØ© Ù…ØªØ­Ø±ÙƒØ© */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                radial-gradient(circle at 20% 50%, rgba(120, 119, 198, 0.3) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(255, 119, 198, 0.3) 0%, transparent 50%),
                radial-gradient(circle at 40% 40%, rgba(120, 219, 255, 0.3) 0%, transparent 50%);
            animation: neonShift 8s ease-in-out infinite;
            pointer-events: none;
            z-index: -2;
        }

        @keyframes neonShift {
            0%, 100% { opacity: 0.3; }
            50% { opacity: 0.6; }
        }

        .chat-container {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 25px;
            box-shadow: 
                0 25px 80px rgba(0, 0, 0, 0.3),
                0 0 0 1px rgba(255, 255, 255, 0.1);
            width: 95%;
            max-width: 900px;
            height: 95vh;
            display: flex;
            flex-direction: column;
            position: relative;
            overflow: hidden;
            animation: containerEntry 1s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            border: 2px solid rgba(255, 255, 255, 0.2);
        }

        @keyframes containerEntry {
            from {
                opacity: 0;
                transform: translateY(50px) scale(0.9);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        /* Ø¬Ø²ÙŠØ¦Ø§Øª Ù…ØªØ­Ø±ÙƒØ© */
        .floating-particles {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
            pointer-events: none;
            z-index: 1;
        }

        .particle {
            position: absolute;
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4, #45b7d1, #96ceb4);
            border-radius: 50%;
            animation: particleFloat 12s linear infinite;
            opacity: 0;
        }

        @keyframes particleFloat {
            0% {
                opacity: 0;
                transform: translateY(100vh) rotate(0deg) scale(0);
            }
            10% {
                opacity: 1;
                transform: translateY(90vh) rotate(36deg) scale(1);
            }
            90% {
                opacity: 1;
                transform: translateY(-10vh) rotate(324deg) scale(1);
            }
            100% {
                opacity: 0;
                transform: translateY(-20vh) rotate(360deg) scale(0);
            }
        }

        .chat-header {
            background: linear-gradient(135deg, #ff6b6b 0%, #4ecdc4 50%, #45b7d1 100%);
            color: white;
            padding: 25px;
            text-align: center;
            position: relative;
            overflow: hidden;
            z-index: 10;
        }

        .chat-header::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: conic-gradient(from 0deg, transparent, rgba(255,255,255,0.1), transparent);
            animation: headerRotate 6s linear infinite;
        }

        @keyframes headerRotate {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .chat-header h1 {
            font-size: 2.2rem;
            margin-bottom: 8px;
            position: relative;
            z-index: 2;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
            animation: titlePulse 3s ease-in-out infinite;
        }

        @keyframes titlePulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .chat-header p {
            opacity: 0.95;
            position: relative;
            z-index: 2;
            font-size: 1.1rem;
        }

        .sound-toggle {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: none;
            padding: 12px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 1.4rem;
            z-index: 10;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }

        .sound-toggle:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: scale(1.2) rotate(15deg);
        }

        .chat-messages {
            flex: 1;
            padding: 25px;
            overflow-y: auto;
            background: linear-gradient(to bottom, 
                rgba(248, 249, 250, 0.9), 
                rgba(233, 236, 239, 0.9));
            position: relative;
            z-index: 2;
        }

        .chat-messages::-webkit-scrollbar {
            width: 8px;
        }

        .chat-messages::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.1);
            border-radius: 10px;
        }

        .chat-messages::-webkit-scrollbar-thumb {
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4);
            border-radius: 10px;
        }

        .message {
            margin-bottom: 20px;
            animation: messageSlide 0.8s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }

        @keyframes messageSlide {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .user-message {
            display: flex;
            justify-content: flex-start;
        }

        .bot-message {
            display: flex;
            justify-content: flex-end;
        }

        .message-bubble {
            max-width: 75%;
            padding: 18px 25px;
            border-radius: 25px;
            position: relative;
            word-wrap: break-word;
            font-size: 1.1rem;
            line-height: 1.5;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: all 0.3s ease;
        }

        .message-bubble:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.15);
        }

        .user-bubble {
            background: linear-gradient(135deg, #ff6b6b 0%, #ff8e8e 100%);
            color: white;
            animation: userBubbleEntry 0.6s ease-out;
        }

        .bot-bubble {
            background: linear-gradient(135deg, #4ecdc4 0%, #44a08d 100%);
            color: white;
            animation: botBubbleEntry 0.6s ease-out;
        }

        @keyframes userBubbleEntry {
            from {
                opacity: 0;
                transform: translateX(-30px) scale(0.8);
            }
            to {
                opacity: 1;
                transform: translateX(0) scale(1);
            }
        }

        @keyframes botBubbleEntry {
            from {
                opacity: 0;
                transform: translateX(30px) scale(0.8);
            }
            to {
                opacity: 1;
                transform: translateX(0) scale(1);
            }
        }

        .message-info {
            font-size: 0.9rem;
            margin-top: 10px;
            opacity: 0.9;
            display: flex;
            gap: 15px;
            align-items: center;
            flex-wrap: wrap;
        }

        .confidence-bar {
            background: rgba(255, 255, 255, 0.3);
            border-radius: 12px;
            height: 8px;
            width: 120px;
            overflow: hidden;
            position: relative;
        }

        .confidence-fill {
            height: 100%;
            border-radius: 12px;
            transition: all 1.5s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }

        .confidence-fill::after {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent);
            animation: shimmer 2s infinite;
        }

        @keyframes shimmer {
            0% { left: -100%; }
            100% { left: 100%; }
        }

        .confidence-high { 
            background: linear-gradient(90deg, #28a745, #20c997);
        }
        .confidence-medium { 
            background: linear-gradient(90deg, #ffc107, #fd7e14);
        }
        .confidence-low { 
            background: linear-gradient(90deg, #dc3545, #e74c3c);
        }

        /* Ù…Ø¤Ø´Ø± Ø§Ù„ÙƒØªØ§Ø¨Ø© */
        .typing-indicator {
            display: none;
            padding: 15px 25px;
            background: rgba(78, 205, 196, 0.15);
            border-radius: 25px;
            margin-bottom: 20px;
            align-items: center;
            gap: 12px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(78, 205, 196, 0.3);
            animation: typingPulse 2s ease-in-out infinite;
        }

        @keyframes typingPulse {
            0%, 100% { opacity: 0.7; }
            50% { opacity: 1; }
        }

        .typing-dots {
            display: flex;
            gap: 6px;
        }

        .typing-dot {
            width: 10px;
            height: 10px;
            background: #4ecdc4;
            border-radius: 50%;
            animation: typingBounce 1.4s ease-in-out infinite;
        }

        .typing-dot:nth-child(2) { animation-delay: 0.2s; }
        .typing-dot:nth-child(3) { animation-delay: 0.4s; }

        @keyframes typingBounce {
            0%, 60%, 100% {
                transform: translateY(0);
            }
            30% {
                transform: translateY(-15px);
            }
        }

        /* Ø§Ù„Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø³Ø±ÙŠØ¹Ø© */
        .quick-buttons {
            padding: 20px 25px;
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(15px);
            border-top: 1px solid rgba(0, 0, 0, 0.1);
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
            justify-content: center;
            z-index: 2;
        }

        .quick-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 30px;
            cursor: pointer;
            font-size: 0.95rem;
            font-weight: 600;
            transition: all 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            position: relative;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
        }

        .quick-btn::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 50%;
            transition: all 0.5s ease;
            transform: translate(-50%, -50%);
        }

        .quick-btn:hover {
            transform: translateY(-3px) scale(1.05);
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.4);
        }

        .quick-btn:hover::before {
            width: 120px;
            height: 120px;
        }

        .quick-btn:active {
            transform: translateY(0) scale(0.95);
        }

        /* Ø­Ù‚Ù„ Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„ */
        .input-container {
            padding: 25px;
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(15px);
            display: flex;
            gap: 15px;
            align-items: center;
            border-top: 1px solid rgba(0, 0, 0, 0.1);
            z-index: 2;
        }

        .message-input {
            flex: 1;
            padding: 15px 25px;
            border: 2px solid rgba(102, 126, 234, 0.3);
            border-radius: 30px;
            font-size: 1.1rem;
            outline: none;
            transition: all 0.3s ease;
            font-family: inherit;
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(10px);
        }

        .message-input:focus {
            border-color: #667eea;
            box-shadow: 0 0 25px rgba(102, 126, 234, 0.3);
            background: rgba(255, 255, 255, 0.95);
        }

        .send-btn {
            background: linear-gradient(135deg, #ff6b6b 0%, #4ecdc4 100%);
            color: white;
            border: none;
            padding: 15px;
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.4s ease;
            font-size: 1.3rem;
            width: 60px;
            height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 8px 25px rgba(255, 107, 107, 0.3);
        }

        .send-btn:hover {
            transform: scale(1.15) rotate(10deg);
            box-shadow: 0 12px 35px rgba(255, 107, 107, 0.4);
        }

        .send-btn:active {
            transform: scale(0.95);
        }

        /* Ù†Ø§ÙØ°Ø© Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª */
        .stats-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            animation: overlayFadeIn 0.4s ease;
        }

        @keyframes overlayFadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .stats-content {
            background: linear-gradient(135deg, rgba(255,255,255,0.95) 0%, rgba(248,249,250,0.95) 100%);
            backdrop-filter: blur(20px);
            padding: 35px;
            border-radius: 25px;
            max-width: 600px;
            width: 90%;
            max-height: 80%;
            overflow-y: auto;
            position: relative;
            animation: statsPopIn 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            box-shadow: 0 25px 80px rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        @keyframes statsPopIn {
            from {
                opacity: 0;
                transform: scale(0.7) translateY(50px);
            }
            to {
                opacity: 1;
                transform: scale(1) translateY(0);
            }
        }

        .close-stats {
            position: absolute;
            top: 15px;
            right: 20px;
            background: linear-gradient(45deg, #ff6b6b, #ff8e8e);
            color: white;
            border: none;
            width: 35px;
            height: 35px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 1.3rem;
            transition: all 0.3s ease;
        }

        .close-stats:hover {
            transform: scale(1.2) rotate(90deg);
        }

        /* Ø±Ø³Ø§Ù„Ø© Ø§Ù„ØªØ±Ø­ÙŠØ¨ */
        .welcome-message {
            text-align: center;
            padding: 50px 30px;
            color: #666;
            font-style: italic;
            animation: welcomeFade 2s ease-in-out;
        }

        @keyframes welcomeFade {
            0% { opacity: 0; transform: translateY(20px); }
            100% { opacity: 1; transform: translateY(0); }
        }

        .welcome-message h2 {
            color: #333;
            margin-bottom: 20px;
            font-size: 1.8rem;
            background: linear-gradient(135deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .welcome-message .demo-features {
            margin-top: 25px;
            padding: 20px;
            background: rgba(102, 126, 234, 0.1);
            border-radius: 15px;
            backdrop-filter: blur(10px);
        }

        .welcome-message .demo-features h3 {
            color: #4ecdc4;
            margin-bottom: 10px;
        }

        /* Ø§Ù„ØªØ¬Ø§ÙˆØ¨ Ù…Ø¹ Ø§Ù„Ø´Ø§Ø´Ø§Øª Ø§Ù„ØµØºÙŠØ±Ø© */
        @media (max-width: 768px) {
            .chat-container {
                width: 100%;
                height: 100vh;
                border-radius: 0;
            }

            .message-bubble {
                max-width: 85%;
                font-size: 1rem;
                padding: 15px 20px;
            }

            .quick-buttons {
                padding: 15px;
            }

            .quick-btn {
                font-size: 0.9rem;
                padding: 10px 15px;
            }

            .chat-header h1 {
                font-size: 1.6rem;
            }

            .input-container {
                padding: 20px 15px;
            }
        }

        @media (max-width: 480px) {
            .message-bubble {
                font-size: 0.95rem;
                padding: 12px 18px;
            }

            .message-info {
                flex-direction: column;
                gap: 8px;
                align-items: flex-start;
            }

            .confidence-bar {
                width: 100px;
            }

            .quick-btn {
                font-size: 0.85rem;
                padding: 8px 12px;
            }
        }

        /* ØªØ£Ø«ÙŠØ±Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ© */
        .neon-border {
            box-shadow: 
                0 0 5px rgba(78, 205, 196, 0.5),
                0 0 10px rgba(78, 205, 196, 0.5),
                inset 0 0 5px rgba(78, 205, 196, 0.2);
        }

        .success-flash {
            animation: successFlash 0.6s ease-out;
        }

        @keyframes successFlash {
            0% { background-color: rgba(40, 167, 69, 0.2); }
            100% { background-color: transparent; }
        }
        
        /* Loading animation for academic report */
        .loading-animation {
            display: flex;
            align-items: center;
            gap: 10px;
            font-style: italic;
            color: rgba(255, 255, 255, 0.9);
        }

        .loading-animation::before {
            content: 'â³';
            font-size: 1.5rem;
            animation: spin 1.5s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="chat-container">
        <div class="floating-particles" id="particles"></div>

        <div class="chat-header">
            <button class="sound-toggle" id="soundToggle" title="ØªØ´ØºÙŠÙ„/Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ø£ØµÙˆØ§Øª">ğŸ”Š</button>
            <h1>ğŸ¤– Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯ Ø§Ù„Ø°ÙƒÙŠ</h1>
            <p>ØªØ´Ø§ØªØ¨ÙˆØª Ø°ÙƒÙŠ ÙˆÙ…ØªØ·ÙˆØ±</p>
        </div>

        <div class="chat-messages" id="chatMessages">
            <div class="welcome-message">
                <h2>ğŸ¤– Ø£Ù‡Ù„Ø§Ù‹ ÙˆØ³Ù‡Ù„Ø§Ù‹!</h2>
                <p>ÙƒÙŠÙ ÙŠÙ…ÙƒÙ†Ù†ÙŠ Ù…Ø³Ø§Ø¹Ø¯ØªÙƒ Ø§Ù„ÙŠÙˆÙ…ØŸ</p>
                <p style="margin-top: 15px; color: #4ecdc4; font-weight: bold;">
                    Ø§Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø£Ø²Ø±Ø§Ø± Ø£Ùˆ Ø§ÙƒØªØ¨ Ø³Ø¤Ø§Ù„Ùƒ
                </p>
            </div>
        </div>

        <div class="typing-indicator" id="typingIndicator">
            <span>ğŸ¤– ÙŠÙƒØªØ¨ Ø§Ù„Ø±Ø¯</span>
            <div class="typing-dots">
                <div class="typing-dot"></div>
                <div class="typing-dot"></div>
                <div class="typing-dot"></div>
            </div>
        </div>

        <div class="quick-buttons">
            <button class="quick-btn" onclick="sendQuickMessage('Ù…Ø±Ø­Ø¨Ø§')">ğŸ‘‹ Ù…Ø±Ø­Ø¨Ø§Ù‹</button>
            <button class="quick-btn" onclick="sendQuickMessage('ÙƒÙ… Ø§Ù„Ø³Ø§Ø¹Ø©')">â° Ø§Ù„ÙˆÙ‚Øª</button>
            <button class="quick-btn" onclick="sendQuickMessage('Ø·Ù‚Ø³ Ø§Ù„Ø±ÙŠØ§Ø¶')">ğŸŒ¤ï¸ Ø§Ù„Ø·Ù‚Ø³</button>
            <button class="quick-btn" onclick="sendQuickMessage('Ø·Ø§Ù„Ø¨ Ø£Ø­Ù…Ø¯')">ğŸ‘¥ Ø¨Ø­Ø« Ø·Ù„Ø§Ø¨</button>
            <button class="quick-btn" onclick="sendQuickMessage('Ù„Ø§Ø¨ØªÙˆØ¨')">ğŸ›ï¸ Ù…Ù†ØªØ¬Ø§Øª</button>
            <button class="quick-btn" onclick="sendQuickMessage('Ø¯ÙˆØ§Ø¡ Ù„Ù„ØµØ¯Ø§Ø¹')">ğŸ’Š Ø£Ø¯ÙˆÙŠØ©</button>
            <button class="quick-btn" onclick="triggerImageUpload()" style="background: linear-gradient(45deg, #e74c3c, #c0392b); color: white;">ğŸ“· Ø±ÙØ¹ ÙˆØµÙØ©</button>
            <button class="quick-btn" onclick="showStats()">ğŸ“ˆ Ø£Ø¯Ø§Ø¡ Ø§Ù„Ù†Ø¸Ø§Ù…</button>
            <button class="quick-btn" onclick="getAcademicReport()" style="background: linear-gradient(45deg, #FF6B6B, #4ECDC4); color: white;">ğŸ“ Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø£ÙƒØ§Ø¯ÙŠÙ…ÙŠ</button>
        </div>

        <!-- Ø±ÙØ¹ Ø§Ù„ØµÙˆØ± Ø§Ù„Ù…Ø®ÙÙŠ -->
        <input type="file" id="imageUpload" accept="image/*" style="display: none;" onchange="handleImageUpload(event)">

        <div class="input-container">
            <input 
                type="text" 
                class="message-input" 
                id="messageInput" 
                placeholder="Ø§ÙƒØªØ¨ Ø±Ø³Ø§Ù„ØªÙƒ Ù‡Ù†Ø§ Ø£Ùˆ Ø§Ø±ÙØ¹ ØµÙˆØ±Ø© ÙˆØµÙØ© Ø·Ø¨ÙŠØ©..."
                autocomplete="off"
            >
            <button class="send-btn" id="sendBtn" onclick="sendMessage()">
                ğŸš€
            </button>
        </div>

        <div class="stats-overlay" id="statsOverlay">
            <div class="stats-content">
                <button class="close-stats" onclick="hideStats()">Ã—</button>
                <h3 style="text-align: center; margin-bottom: 25px; color: #333; font-size: 1.5rem;">
                    ğŸ“Š Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… Ø§Ù„ØªÙØ§Ø¹Ù„ÙŠØ©
                </h3>
                <div id="statsContent">
                    <div style="text-align: center; color: #666; padding: 20px;">
                        <div class="typing-dots" style="justify-content: center; margin-bottom: 10px;">
                            <div class="typing-dot"></div>
                            <div class="typing-dot"></div>
                            <div class="typing-dot"></div>
                        </div>
                        Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ù…ØªÙ‚Ø¯Ù…Ø©...
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let soundEnabled = true;
        let messageCount = 0;
        let conversationStartTime = new Date();

        // Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø¬Ø²ÙŠØ¦Ø§Øª Ø§Ù„Ù…ØªØ­Ø±ÙƒØ©
        function createParticles() {
            const container = document.getElementById('particles');
            const particleCount = 25;

            for (let i = 0; i < particleCount; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';

                // Ø£Ø­Ø¬Ø§Ù… ÙˆØ£Ù„ÙˆØ§Ù† Ù…ØªÙ†ÙˆØ¹Ø©
                const size = Math.random() * 8 + 4;
                particle.style.width = particle.style.height = size + 'px';
                particle.style.left = Math.random() * 100 + '%';
                particle.style.animationDelay = Math.random() * 12 + 's';
                particle.style.animationDuration = (Math.random() * 8 + 8) + 's';

                container.appendChild(particle);
            }
        }

        // ØªØ´ØºÙŠÙ„ Ø§Ù„Ø£ØµÙˆØ§Øª Ø§Ù„Ù…Ø­Ø³Ù†Ø©
        function playSound(type, volume = 0.1) {
            if (!soundEnabled) return;

            try {
                const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                let frequency, duration, waveType;

                switch (type) {
                    case 'send':
                        frequency = 880;
                        duration = 0.15;
                        waveType = 'sine';
                        break;
                    case 'receive':
                        frequency = 660;
                        duration = 0.2;
                        waveType = 'sine';
                        break;
                    case 'notification':
                        frequency = 1100;
                        duration = 0.1;
                        waveType = 'square';
                        break;
                    case 'success':
                        // Ù†ØºÙ…Ø© Ù†Ø¬Ø§Ø­ Ù…Ø±ÙƒØ¨Ø©
                        playCompoundSound(audioContext, [523, 659, 784], 0.3, volume);
                        return;
                    case 'hover':
                        frequency = 400;
                        duration = 0.05;
                        waveType = 'sine';
                        volume = 0.03;
                        break;
                    case 'error': // Ø¥Ø¶Ø§ÙØ© ØµÙˆØª Ù„Ù„Ø®Ø·Ø£
                        frequency = 220; // ØªØ±Ø¯Ø¯ Ù…Ù†Ø®ÙØ¶
                        duration = 0.5;
                        waveType = 'sawtooth'; // Ù…ÙˆØ¬Ø© Ø³Ù† Ø§Ù„Ù…Ù†Ø´Ø§Ø± Ù„ØªØ¨Ø¯Ùˆ Ù…Ø²Ø¹Ø¬Ø©
                        volume = 0.2;
                        break;
                    default:
                        frequency = 500;
                        duration = 0.1;
                        waveType = 'sine';
                }

                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();

                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);

                oscillator.frequency.value = frequency;
                oscillator.type = waveType;

                gainNode.gain.setValueAtTime(0, audioContext.currentTime);
                gainNode.gain.linearRampToValueAtTime(volume, audioContext.currentTime + 0.01);
                gainNode.gain.exponentialRampToValueAtTime(0.001, audioContext.currentTime + duration);

                oscillator.start(audioContext.currentTime);
                oscillator.stop(audioContext.currentTime + duration);
            } catch (error) {
                console.log('Audio context not available');
            }
        }

        // ØªØ´ØºÙŠÙ„ Ù†ØºÙ…Ø© Ù…Ø±ÙƒØ¨Ø© Ù„Ù„Ù†Ø¬Ø§Ø­
        function playCompoundSound(audioContext, frequencies, duration, volume) {
            frequencies.forEach((freq, index) => {
                setTimeout(() => {
                    const oscillator = audioContext.createOscillator();
                    const gainNode = audioContext.createGain();

                    oscillator.connect(gainNode);
                    gainNode.connect(audioContext.destination);

                    oscillator.frequency.value = freq;
                    oscillator.type = 'sine';

                    gainNode.gain.setValueAtTime(0, audioContext.currentTime);
                    gainNode.gain.linearRampToValueAtTime(volume, audioContext.currentTime + 0.01);
                    gainNode.gain.exponentialRampToValueAtTime(0.001, audioContext.currentTime + 0.2);

                    oscillator.start(audioContext.currentTime);
                    oscillator.stop(audioContext.currentTime + 0.2);
                }, index * 100);
            });
        }

        // ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„ØµÙˆØª
        function toggleSound() {
            soundEnabled = !soundEnabled;
            const toggle = document.getElementById('soundToggle');
            toggle.textContent = soundEnabled ? 'ğŸ”Š' : 'ğŸ”‡';
            toggle.title = soundEnabled ? 'Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ø£ØµÙˆØ§Øª' : 'ØªØ´ØºÙŠÙ„ Ø§Ù„Ø£ØµÙˆØ§Øª';

            if (soundEnabled) {
                playSound('notification');
                toggle.classList.add('success-flash');
                setTimeout(() => toggle.classList.remove('success-flash'), 600);
            }
        }

        // Ø¥Ø¶Ø§ÙØ© Ø±Ø³Ø§Ù„Ø© Ù„Ù„Ø¯Ø±Ø¯Ø´Ø© Ù…Ø¹ ØªØ­Ø³ÙŠÙ†Ø§Øª
        function addMessage(message, isUser = false, data = null, responseTime = null, type = null) {
            const chatMessages = document.getElementById('chatMessages');
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${isUser ? 'user-message' : 'bot-message'}`;

            let messageContent = `
                <div class="message-bubble ${isUser ? 'user-bubble' : 'bot-bubble'}">
                    ${message}
            `;

            if (!isUser && data && data.confidence !== undefined) {
                const confidence = data.confidence;
                const confidenceClass = confidence >= 70 ? 'confidence-high' : 
                                      confidence >= 30 ? 'confidence-medium' : 'confidence-low';
                const confidenceEmoji = confidence >= 70 ? 'ğŸ¯' : 
                                      confidence >= 30 ? 'ğŸ¤”' : 'ğŸ’­';

                messageContent += `
                    <div class="message-info">
                        <span>${confidenceEmoji} Ø¯Ù‚Ø© Ø§Ù„Ø±Ø¯: ${confidence.toFixed(1)}%</span>
                        <div class="confidence-bar">
                            <div class="confidence-fill ${confidenceClass}" style="width: ${confidence}%"></div>
                        </div>
                        ${data.response_time ? `<span>âš¡ ${data.response_time.toFixed(1)}ms</span>` : ''}
                        ${data.type ? `<span>ğŸ”§ ${getTypeLabel(data.type)}</span>` : ''}
                    </div>
                `;
            } else if (!isUser && data && data.type === 'error') {
                // Ø±Ø³Ø§Ù„Ø© Ø®Ø·Ø£ Ø®Ø§ØµØ©
                messageContent += `
                    <div class="message-info" style="color: #e74c3c;">
                        <span style="font-weight: bold;">ğŸš¨ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ù†Ø¸Ø§Ù…</span>
                    </div>
                `;
            }

            messageContent += '</div>';
            messageDiv.innerHTML = messageContent;

            chatMessages.appendChild(messageDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;

            // ØªØ£Ø«ÙŠØ±Ø§Øª ØµÙˆØªÙŠØ© ÙˆØ¨ØµØ±ÙŠØ©
            if (isUser) {
                playSound('send');
            } else {
                if (data && data.type === 'error') {
                    playSound('error');
                } else {
                    setTimeout(() => playSound('receive'), 200);
                    if (data && data.confidence >= 80) {
                        setTimeout(() => playSound('success'), 400);
                    }
                }
            }

            messageCount++;

            // Ø¥Ø²Ø§Ù„Ø© Ø±Ø³Ø§Ù„Ø© Ø§Ù„ØªØ±Ø­ÙŠØ¨
            if (messageCount === 1 && !isUser) { // ØªØ£ÙƒØ¯ Ù…Ù† Ø£Ù†Ù‡Ø§ Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ø¨ÙˆØª Ø§Ù„Ø£ÙˆÙ„Ù‰
                const welcome = chatMessages.querySelector('.welcome-message');
                if (welcome) {
                    welcome.style.animation = 'messageSlide 0.5s ease-out reverse';
                    setTimeout(() => welcome.style.display = 'none', 500);
                }
            }
        }

        // ØªØ³Ù…ÙŠØ§Øª Ø§Ù„Ø£Ù†ÙˆØ§Ø¹
        function getTypeLabel(type) {
            const labels = {
                'ai_response': 'Ø°ÙƒØ§Ø¡ Ø§ØµØ·Ù†Ø§Ø¹ÙŠ',
                'weather': 'Ø¨ÙŠØ§Ù†Ø§Øª Ø·Ù‚Ø³',
                'search_results': 'Ù†ØªØ§Ø¦Ø¬ Ø¨Ø­Ø«',
                'statistics': 'Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª',
                'products': 'ÙƒØªØ§Ù„ÙˆØ¬ Ù…Ù†ØªØ¬Ø§Øª',
                'keyword_match': 'Ù…Ø·Ø§Ø¨Ù‚Ø© ÙƒÙ„Ù…Ø§Øª',
                'error': 'Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§Ø³ØªØ¬Ø§Ø¨Ø©',
                'default': 'Ø±Ø¯ Ø§ÙØªØ±Ø§Ø¶ÙŠ'
            };
            return labels[type] || type;
        }

        // Ø¹Ø±Ø¶ Ù…Ø¤Ø´Ø± Ø§Ù„ÙƒØªØ§Ø¨Ø©
        function showTyping() {
            const indicator = document.getElementById('typingIndicator');
            indicator.style.display = 'flex';
            const chatMessages = document.getElementById('chatMessages');
            chatMessages.scrollTop = chatMessages.scrollHeight + 100;
        }

        // Ø¥Ø®ÙØ§Ø¡ Ù…Ø¤Ø´Ø± Ø§Ù„ÙƒØªØ§Ø¨Ø©
        function hideTyping() {
            document.getElementById('typingIndicator').style.display = 'none';
        }

        // Ø¥Ø±Ø³Ø§Ù„ Ø±Ø³Ø§Ù„Ø© Ù…Ø­Ø³Ù†Ø© Ù…Ø¹ Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø£Ø®Ø·Ø§Ø¡
        async function sendMessage() {
            const input = document.getElementById('messageInput');
            const message = input.value.trim();

            if (!message) {
                input.style.animation = 'shake 0.5s ease-in-out';
                setTimeout(() => input.style.animation = '', 500);
                return;
            }

            // Ø¥Ø¶Ø§ÙØ© Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
            addMessage(message, true);
            input.value = '';
            input.blur(); // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„ØªØ±ÙƒÙŠØ² Ù„Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„

            // Ø¥Ø¸Ù‡Ø§Ø± Ù…Ø¤Ø´Ø± Ø§Ù„ÙƒØªØ§Ø¨Ø©
            showTyping();

            try {
                const controller = new AbortController();
                const timeoutId = setTimeout(() => controller.abort(), 10000); // 10 Ø«ÙˆØ§Ù†ÙŠ timeout

                const response = await fetch('/chat', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ message: message }),
                    signal: controller.signal
                });

                clearTimeout(timeoutId);

                if (!response.ok) {
                    // Ø§Ù„ØªØ¹Ø§Ù…Ù„ Ù…Ø¹ Ø§Ø³ØªØ¬Ø§Ø¨Ø§Øª Ø§Ù„Ø®Ø§Ø¯Ù… ØºÙŠØ± Ø§Ù„Ù†Ø§Ø¬Ø­Ø© (Ù…Ø«Ù„ 4xx, 5xx)
                    const errorText = await response.text(); // Ø­Ø§ÙˆÙ„ Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ù†Øµ Ø§Ù„Ø®Ø·Ø£ Ø¥Ù† ÙˆØ¬Ø¯
                    throw new Error(`Server error: ${response.status} - ${errorText || 'Unknown error'}`);
                }

                const data = await response.json();

                // Ø¥Ø®ÙØ§Ø¡ Ù…Ø¤Ø´Ø± Ø§Ù„ÙƒØªØ§Ø¨Ø©
                hideTyping();

                // ØªØ£Ø®ÙŠØ± Ø·Ø¨ÙŠØ¹ÙŠ Ù„Ù„Ø±Ø¯
                setTimeout(() => {
                    addMessage(
                        data.response, 
                        false, 
                        data, // ØªÙ…Ø±ÙŠØ± Ø§Ù„ÙƒØ§Ø¦Ù† ÙƒØ§Ù…Ù„Ø§Ù‹ Ù„Ù€ addMessage
                        data.response_time, 
                        data.type
                    );
                }, Math.random() * 500 + 300);

            } catch (error) {
                hideTyping();
                let errorMessage = 'âŒ Ø¹Ø°Ø±Ø§Ù‹ØŒ Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„.';

                if (error.name === 'AbortError') {
                    errorMessage = 'â±ï¸ Ø§Ù†ØªÙ‡Øª Ù…Ù‡Ù„Ø© Ø§Ù„Ø§ØªØµØ§Ù„. ÙŠØ±Ø¬Ù‰ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.';
                } else if (error.message && error.message.includes('Failed to fetch')) {
                    errorMessage = 'ğŸ”„ ÙÙ‚Ø¯ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø®Ø§Ø¯Ù…. ÙŠØ±Ø¬Ù‰ Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø£Ù† Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ ÙŠØ¹Ù…Ù„.';
                } else if (error.message && error.message.includes('500')) {
                    errorMessage = 'âŒ Ø®Ø·Ø£ Ù…Ù† Ø§Ù„Ø®Ø§Ø¯Ù… (500). ØªÙ… Ø¥ØµÙ„Ø§Ø­ Ø§Ù„Ù…Ø´ÙƒÙ„Ø© ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹!';
                } else if (error.message && error.message.startsWith('Server error:')) {
                    errorMessage = `âŒ Ø®Ø·Ø£ Ù…Ù† Ø§Ù„Ø®Ø§Ø¯Ù… (${error.message.replace('Server error: ', '')}).`;
                } else if (error.response) {
                    errorMessage = `âŒ Ø®Ø·Ø£ HTTP ${error.response.status}: ${error.response.statusText}`;
                }

                addMessage(errorMessage + '\n\nğŸ”§ Ø§Ù„Ø­Ù„ÙˆÙ„:\nâ€¢ Ø§Ù„Ù†Ø¸Ø§Ù… ØªÙ… Ø¥ØµÙ„Ø§Ø­Ù‡ Ø§Ù„Ø¢Ù† âœ…\nâ€¢ Ø¬Ø±Ø¨ Ø¥Ø±Ø³Ø§Ù„ Ø±Ø³Ø§Ù„Ø© Ø£Ø®Ø±Ù‰\nâ€¢ Ø§Ø¶ØºØ· F5 Ø¥Ø°Ø§ Ø§Ø³ØªÙ…Ø± Ø§Ù„Ø®Ø·Ø£', false, { type: 'error' });
                console.error('Connection Error Details:', {
                    message: error.message,
                    name: error.name,
                    stack: error.stack
                });
            }
        }

        // Ø¥Ø±Ø³Ø§Ù„ Ø±Ø³Ø§Ù„Ø© Ø³Ø±ÙŠØ¹Ø©
        function sendQuickMessage(message) {
            const input = document.getElementById('messageInput');
            input.value = message;

            // ØªØ£Ø«ÙŠØ± Ø¨ØµØ±ÙŠ
            input.classList.add('neon-border');
            setTimeout(() => input.classList.remove('neon-border'), 1000);

            sendMessage();
            playSound('hover');
        }

        // Ø¹Ø±Ø¶ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ù…Ø­Ø³Ù†Ø©
        async function showStats() {
            const overlay = document.getElementById('statsOverlay');
            const content = document.getElementById('statsContent');

            overlay.style.display = 'flex';
            playSound('notification');

            try {
                const response = await fetch('/stats');
                if (!response.ok) {
                    throw new Error(`Server error: ${response.status}`);
                }
                const data = await response.json();

                const sessionDuration = Math.floor((new Date() - conversationStartTime) / 1000);
                const minutes = Math.floor(sessionDuration / 60);
                const seconds = sessionDuration % 60;

                content.innerHTML = `
                    <div style="text-align: right; direction: rtl;">
                        <div style="background: linear-gradient(135deg, #667eea, #764ba2); padding: 20px; border-radius: 15px; color: white; margin-bottom: 20px; text-align: center;">
                            <h4 style="margin: 0; font-size: 1.3rem;">ğŸš€ Ø£Ø¯Ø§Ø¡ Ø§Ù„Ù†Ø¸Ø§Ù…</h4>
                        </div>

                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 20px;">
                            <div style="background: rgba(40, 167, 69, 0.1); padding: 15px; border-radius: 10px; text-align: center;">
                                <div style="font-size: 2rem; margin-bottom: 5px;">ğŸ’¬</div>
                                <div style="font-size: 1.5rem; font-weight: bold; color: #28a745;">${data.total_conversations}</div>
                                <div style="color: #666;">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø§Øª</div>
                            </div>

                            <div style="background: rgba(0, 123, 255, 0.1); padding: 15px; border-radius: 10px; text-align: center;">
                                <div style="font-size: 2rem; margin-bottom: 5px;">ğŸ¯</div>
                                <div style="font-size: 1.5rem; font-weight: bold; color: #007bff;">${data.avg_confidence !== undefined ? data.avg_confidence.toFixed(1) : 'N/A'}%</div>
                                <div style="color: #666;">Ù…ØªÙˆØ³Ø· Ø§Ù„Ø¯Ù‚Ø©</div>
                            </div>

                            <div style="background: rgba(255, 193, 7, 0.1); padding: 15px; border-radius: 10px; text-align: center;">
                                <div style="font-size: 2rem; margin-bottom: 5px;">â±ï¸</div>
                                <div style="font-size: 1.5rem; font-weight: bold; color: #ffc107;">${minutes}:${seconds.toString().padStart(2, '0')}</div>
                                <div style="color: #666;">Ù…Ø¯Ø© Ø§Ù„Ø¬Ù„Ø³Ø©</div>
                            </div>
                        </div>

                        <div style="background: rgba(78, 205, 196, 0.1); padding: 20px; border-radius: 15px; margin-bottom: 15px;">
                            <h4 style="color: #4ecdc4; margin-bottom: 15px; display: flex; align-items: center; gap: 8px;">
                                ğŸ”¥ Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ø§Ù„Ø£ÙƒØ«Ø± ØªÙƒØ±Ø§Ø±Ø§Ù‹
                            </h4>
                            <ol style="padding-right: 25px; line-height: 1.8;">
                                ${data.popular_questions && data.popular_questions.length > 0 ? data.popular_questions.slice(0, 5).map(([question, count], index) => 
                                    `<li style="margin-bottom: 8px;">
                                        <strong style="color: #333;">${question}</strong> 
                                        <span style="background: #4ecdc4; color: white; padding: 2px 8px; border-radius: 12px; font-size: 0.8rem;">${count} Ù…Ø±Ø©</span>
                                    </li>`
                                ).join('') : '<li>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£Ø³Ø¦Ù„Ø© Ø´Ø§Ø¦Ø¹Ø© Ø¨Ø¹Ø¯.</li>'}
                            </ol>
                        </div>

                        <div style="text-align: center; padding: 20px; background: linear-gradient(135deg, #ff6b6b, #4ecdc4); color: white; border-radius: 15px; margin-top: 20px;">
                            <div style="font-size: 1.2rem; font-weight: bold; margin-bottom: 10px;">
                                ğŸŒŸ Ø§Ù„Ù†Ø¸Ø§Ù… ÙŠØ¹Ù…Ù„ Ø¨ÙƒÙØ§Ø¡Ø© Ø¹Ø§Ù„ÙŠØ©!
                            </div>
                            <div style="opacity: 0.9;">
                                ØªÙ‚Ù†ÙŠØ§Øª Ù…ØªØ·ÙˆØ±Ø©: SQLite + Scikit-learn + Flask
                            </div>
                        </div>
                    </div>
                `;

                playSound('success');

            } catch (error) {
                console.error('Stats error:', error);
                content.innerHTML = `
                    <div style="text-align: center; color: #dc3545; padding: 20px;">
                        <div style="font-size: 2rem; margin-bottom: 10px;">âš ï¸</div>
                        <div>Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª</div>
                        <button onclick="showStats()" style="margin-top: 15px; padding: 10px 20px; background: #007bff; color: white; border: none; border-radius: 8px; cursor: pointer;">
                            Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø©
                        </button>
                    </div>
                `;
            }
        }

        // Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
        function hideStats() {
            document.getElementById('statsOverlay').style.display = 'none';
            playSound('hover');
        }
        
        // Ø¯Ø§Ù„Ø© Ù„Ø¹Ø±Ø¶ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
        function displayStats(data) {
            // Ù‡Ø°Ù‡ Ø§Ù„Ø¯Ø§Ù„Ø© Ù…ÙˆØ¬ÙˆØ¯Ø© ÙˆÙ„ÙƒÙ†Ù‡Ø§ ØºÙŠØ± Ù…Ø³ØªØ®Ø¯Ù…Ø© Ø­Ø§Ù„ÙŠÙ‹Ø§ ÙÙŠ Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ø£ØµÙ„ÙŠ
            // ÙŠÙ…ÙƒÙ† Ø§Ø³ØªØ¨Ø¯Ø§Ù„ Ù…Ø­ØªÙˆØ§Ù‡Ø§ Ø¥Ø°Ø§ Ù„Ø²Ù… Ø§Ù„Ø£Ù…Ø±
            console.log("Displaying stats:", data);
        }

        // Ø¯Ø§Ù„Ø© Ù„ØªÙ…Ø±ÙŠØ± Ù„Ø£Ø³ÙÙ„ Ø§Ù„Ø¯Ø±Ø¯Ø´Ø©
        function scrollToBottom() {
            const chatMessages = document.getElementById('chatMessages');
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        // ØªØ´ØºÙŠÙ„ ØµÙˆØª Ø¥Ø´Ø¹Ø§Ø±
        function playNotificationSound() {
            playSound('notification');
        }

        // Ø¯Ø§Ù„Ø© Ø±ÙØ¹ Ø§Ù„ØµÙˆØ± Ø§Ù„Ø·Ø¨ÙŠØ©
        function triggerImageUpload() {
            const fileInput = document.getElementById('imageUpload');
            fileInput.click();
            playSound('hover');
        }

        // Ù…Ø¹Ø§Ù„Ø¬Ø© Ø±ÙØ¹ Ø§Ù„ØµÙˆØ±Ø©
        function handleImageUpload(event) {
            const file = event.target.files[0];
            if (!file) return;

            // ØªØ­Ù‚Ù‚ Ù…Ù† Ù†ÙˆØ¹ Ø§Ù„Ù…Ù„Ù
            if (!file.type.startsWith('image/')) {
                addMessage('âŒ ÙŠØ±Ø¬Ù‰ Ø±ÙØ¹ ØµÙˆØ±Ø© ÙÙ‚Ø· (JPG, PNG, etc)', false, { type: 'error' });
                return;
            }

            // ØªØ­Ù‚Ù‚ Ù…Ù† Ø­Ø¬Ù… Ø§Ù„Ù…Ù„Ù (5MB max)
            if (file.size > 5 * 1024 * 1024) {
                addMessage('âŒ Ø­Ø¬Ù… Ø§Ù„ØµÙˆØ±Ø© ÙƒØ¨ÙŠØ± Ø¬Ø¯Ø§Ù‹. Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰ 5MB', false, { type: 'error' });
                return;
            }

            // Ø¹Ø±Ø¶ Ø±Ø³Ø§Ù„Ø© ØªØ­Ù…ÙŠÙ„
            addMessage(`ğŸ“· ØªÙ… Ø±ÙØ¹ Ø§Ù„ØµÙˆØ±Ø©: ${file.name}`, true);
            
            // Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„ØµÙˆØ±Ø© ÙˆØªØ­ÙˆÙŠÙ„Ù‡Ø§ Ø¥Ù„Ù‰ base64
            const reader = new FileReader();
            reader.onload = function(e) {
                const base64Data = e.target.result.split(',')[1]; // Ø¥Ø²Ø§Ù„Ø© data:image/...;base64,
                processUploadedImage(base64Data, file.name);
            };
            reader.readAsDataURL(file);
            
            // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ù‚ÙŠÙ…Ø© input
            event.target.value = '';
        }

        // Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„Ù…Ø±ÙÙˆØ¹Ø©
        async function processUploadedImage(base64Data, fileName) {
            showTyping();
            
            try {
                const response = await fetch('/process_image', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ 
                        image_data: base64Data,
                        file_name: fileName 
                    })
                });

                const data = await response.json();
                hideTyping();

                if (data.success) {
                    let responseText = `ğŸ¥ ØªÙ… ØªØ­Ù„ÙŠÙ„ Ø§Ù„ÙˆØµÙØ© Ø§Ù„Ø·Ø¨ÙŠØ© Ø¨Ù†Ø¬Ø§Ø­!\n\n`;
                    
                    if (data.medicines_found && data.medicines_found.length > 0) {
                        responseText += `ğŸ’Š Ø§Ù„Ø£Ø¯ÙˆÙŠØ© Ø§Ù„Ù…ÙˆØ¬ÙˆØ¯Ø©:\n`;
                        data.medicines_found.forEach(med => {
                            responseText += `â€¢ ${med.name} (${med.name_en}) - ${med.dose} ${med.frequency}\n`;
                        });
                        responseText += '\n';
                    }
                    
                    if (data.recommendations && data.recommendations.length > 0) {
                        responseText += `ğŸ“‹ Ø§Ù„ØªÙˆØµÙŠØ§Øª:\n${data.recommendations.join('\n')}\n\n`;
                    }
                    
                    responseText += `ğŸ“ Ø§Ù„Ù†Øµ Ø§Ù„Ù…Ø³ØªØ®Ø±Ø¬:\n${data.extracted_text.substring(0, 200)}${data.extracted_text.length > 200 ? '...' : ''}`;
                    
                    addMessage(responseText, false, { type: 'medical_ocr', confidence: 95 });
                    playSound('success');
                } else {
                    addMessage(`âŒ ${data.error}\n\n${data.message || ''}`, false, { type: 'error' });
                }

            } catch (error) {
                hideTyping();
                addMessage('âŒ Ø®Ø·Ø£ ÙÙŠ Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„ØµÙˆØ±Ø©. ØªØ£ÙƒØ¯ Ù…Ù† ÙˆØ¶ÙˆØ­ Ø§Ù„ØµÙˆØ±Ø© ÙˆØ¬ÙˆØ¯Ø© Ø§Ù„Ù†Øµ.', false, { type: 'error' });
                console.error('Image processing error:', error);
            }
        }

        // Ø¯Ø§Ù„Ø© JavaScript Ù„Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø£ÙƒØ§Ø¯ÙŠÙ…ÙŠ
        function getAcademicReport() {
            // Ø¥Ø¶Ø§ÙØ© Ø±Ø³Ø§Ù„Ø© ØªØ­Ù…ÙŠÙ„
            const loadingMessageHtml = `
                <div class="message bot-message">
                    <div class="message-bubble academic-report-loading" style="background: linear-gradient(45deg, #667eea, #764ba2); color: white;">
                        <div class="loading-animation">
                            <span style="font-size: 1.5rem; margin-left: 10px;">ğŸ“</span> 
                            Ø¬Ø§Ø±ÙŠ Ø¥Ù†ØªØ§Ø¬ Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø£ÙƒØ§Ø¯ÙŠÙ…ÙŠ Ø§Ù„Ù…ØªÙ‚Ø¯Ù…...
                            <br><small>ØªØ­Ù„ÙŠÙ„ Ø´Ø§Ù…Ù„ Ù„Ù„Ù…Ø´Ø±ÙˆØ¹ - mBERT & Transformers</small>
                        </div>
                    </div>
                </div>
            `;
            document.getElementById('chatMessages').innerHTML += loadingMessageHtml;
            scrollToBottom();

            fetch('/academic_report')
                .then(response => {
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    return response.json();
                })
                .then(data => {
                    // Ø¥Ø²Ø§Ù„Ø© Ø±Ø³Ø§Ù„Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„
                    const messagesContainer = document.getElementById('chatMessages');
                    messagesContainer.removeChild(messagesContainer.lastElementChild);
                    
                    displayAcademicReport(data);
                })
                .catch(error => {
                    console.error('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø£ÙƒØ§Ø¯ÙŠÙ…ÙŠ:', error);
                    // Ø¥Ø²Ø§Ù„Ø© Ø±Ø³Ø§Ù„Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„ ÙˆØ¥Ø¸Ù‡Ø§Ø± Ø®Ø·Ø£
                    const messagesContainer = document.getElementById('chatMessages');
                    // Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø§Ù„Ø¹Ù†ØµØ± Ù‚Ø¨Ù„ Ù…Ø­Ø§ÙˆÙ„Ø© Ø¥Ø²Ø§Ù„ØªÙ‡
                    if (messagesContainer.lastElementChild && messagesContainer.lastElementChild.classList.contains('academic-report-loading')) {
                        messagesContainer.removeChild(messagesContainer.lastElementChild);
                    }

                    addMessage('âŒ Ø®Ø·Ø£ ÙÙŠ Ø¥Ù†ØªØ§Ø¬ Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø£ÙƒØ§Ø¯ÙŠÙ…ÙŠ. ÙŠØ±Ø¬Ù‰ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.', false, { type: 'error' });
                });
        }

        function displayAcademicReport(data) {
            let reportHtml = `
                <div class="message bot-message">
                    <div class="message-bubble academic-report" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; max-width: 90%; font-size: 0.9rem;">
                        <h3 style="margin: 0 0 15px 0; text-align: center;">ğŸ“ Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø£ÙƒØ§Ø¯ÙŠÙ…ÙŠ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ</h3>
            `;

            if (data.status === 'success' && data.report) {
                const report = data.report;

                reportHtml += `
                    <div style="background: rgba(255,255,255,0.1); padding: 15px; border-radius: 10px; margin: 10px 0;">
                        <h4>ğŸ“‹ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ø´Ø±ÙˆØ¹</h4>
                        <p><strong>Ø§Ù„Ø¹Ù†ÙˆØ§Ù†:</strong> ${report.project_info.title || 'Ù…Ø´Ø±ÙˆØ¹ ØªØ®Ø±Ø¬ Ù…ØªÙ‚Ø¯Ù…'}</p>
                        <p><strong>Ø§Ù„ØªÙ‚Ù†ÙŠØ§Øª:</strong> ${report.project_info.technologies.join(', ')}</p>
                        <p><strong>Ø§Ù„Ø¯Ø¹Ù… Ø§Ù„Ù„ØºÙˆÙŠ:</strong> ${report.project_info.languages_supported.join(', ')}</p>
                    </div>

                    <div style="background: rgba(255,255,255,0.1); padding: 15px; border-radius: 10px; margin: 10px 0;">
                        <h4>âš¡ Ø§Ù„Ù…ÙˆØ§ØµÙØ§Øª Ø§Ù„ØªÙ‚Ù†ÙŠØ©</h4>
                        <p><strong>Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ:</strong> ${report.technical_specifications.ai_model || 'mBERT'}</p>
                        <p><strong>Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª:</strong> ${report.technical_specifications.database || 'SQLite'}</p>
                        <p><strong>Ø§Ù„ØªÙƒØ§Ù…Ù„Ø§Øª:</strong> ${report.technical_specifications.api_integrations.join(', ')}</p>
                    </div>

                    <div style="background: rgba(255,255,255,0.1); padding: 15px; border-radius: 10px; margin: 10px 0;">
                        <h4>ğŸ“Š Ù…Ù‚Ø§ÙŠÙŠØ³ Ø§Ù„Ø£Ø¯Ø§Ø¡</h4>
                        <p><strong>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø§Øª:</strong> ${report.performance_metrics.total_conversations || 'N/A'}</p>
                        <p><strong>Ù…ØªÙˆØ³Ø· Ø§Ù„Ø«Ù‚Ø©:</strong> ${(report.performance_metrics.average_confidence || 0).toFixed(2)}%</p>
                        <p><strong>Ø²Ù…Ù† Ø§Ù„Ø§Ø³ØªØ¬Ø§Ø¨Ø©:</strong> ${(report.performance_metrics.average_response_time || 0).toFixed(2)} ms</p>
                    </div>

                    <div style="background: rgba(255,255,255,0.1); padding: 15px; border-radius: 10px; margin: 10px 0;">
                        <h4>ğŸŒ Ø§Ù„Ø¯Ø¹Ù… Ù…ØªØ¹Ø¯Ø¯ Ø§Ù„Ù„ØºØ§Øª</h4>
                        <p><strong>Ø­Ø§Ù„Ø© mBERT:</strong> ${report.multilingual_support.mbert_status ? 'Ù†Ø´Ø· âœ…' : 'ØºÙŠØ± Ù†Ø´Ø· âš ï¸'}</p>
                        <p><strong>Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ø£ÙƒØ§Ø¯ÙŠÙ…ÙŠØ©:</strong> ${report.multilingual_support.academic_value.transformer_integration || 'Ù‚ÙŠÙ…Ø© Ø¹Ø§Ù„ÙŠØ©'}</p>
                    </div>
                `;
            } else {
                // ØªÙ‚Ø±ÙŠØ± Ø£Ø³Ø§Ø³ÙŠ ÙÙŠ Ø­Ø§Ù„Ø© Ø¹Ø¯Ù… Ù†Ø¬Ø§Ø­ Ø§Ø³ØªØ¬Ø§Ø¨Ø© Ø§Ù„Ø®Ø§Ø¯Ù…
                reportHtml += `
                    <div style="background: rgba(255,255,255,0.1); padding: 15px; border-radius: 10px; margin: 10px 0;">
                        <h4>ğŸ“‹ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø£Ø³Ø§Ø³ÙŠØ©</h4>
                        <p><strong>Ø§Ù„Ø¹Ù†ÙˆØ§Ù†:</strong> ${data.project_info?.title || 'Ù†Ø¸Ø§Ù… Ø§Ù„ØªØ´Ø§ØªØ¨ÙˆØª Ø§Ù„Ø°ÙƒÙŠ'}</p>
                        <p><strong>Ø§Ù„Ù†Ù…ÙˆØ°Ø¬:</strong> ${data.project_info?.model || 'Hybrid AI'}</p>
                        <p><strong>Ø§Ù„Ù„ØºØ§Øª:</strong> ${(data.project_info?.languages || ['Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©', 'Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ©']).join(', ')}</p>
                        <p><strong>Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ø£ÙƒØ§Ø¯ÙŠÙ…ÙŠØ©:</strong> ${data.project_info?.academic_value || 'Ù…Ø´Ø±ÙˆØ¹ Ù…ØªÙ‚Ø¯Ù…'}</p>
                    </div>
                    <div style="text-align: center; color: #ffc107; margin-top: 15px;">
                        <small>âš ï¸ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ ØªÙØ§ØµÙŠÙ„ ØªÙ‚Ø±ÙŠØ± Ù…ÙØµÙ„Ø©. ØªÙ… Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©.</small>
                    </div>
                `;
            }

            reportHtml += `
                        <div style="text-align: center; margin: 15px 0 5px 0; padding: 10px; background: rgba(255,255,255,0.05); border-radius: 8px;">
                            <small>ğŸ¯ Ù…Ø´Ø±ÙˆØ¹ ØªØ®Ø±Ø¬ Ù…ØªÙ‚Ø¯Ù… - Ø¯Ù…Ø¬ Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ Ù…Ø¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠØ©</small>
                        </div>
                    </div>
                </div>
            `;

            document.getElementById('chatMessages').innerHTML += reportHtml;
            scrollToBottom();

            // ØªØ£Ø«ÙŠØ± ØµÙˆØªÙŠ
            playNotificationSound();
        }

        // Ø§Ù„Ø£Ø­Ø¯Ø§Ø«
        document.getElementById('messageInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                e.preventDefault();
                sendMessage();
            }
        });

        document.getElementById('soundToggle').addEventListener('click', toggleSound);

        // Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø¨Ø§Ù„Ø¶ØºØ· Ø®Ø§Ø±Ø¬Ù‡Ø§
        document.getElementById('statsOverlay').addEventListener('click', function(e) {
            if (e.target === this) {
                hideStats();
            }
        });

        // ØªØ£Ø«ÙŠØ±Ø§Øª Ø§Ù„Ø£Ø²Ø±Ø§Ø±
        document.querySelectorAll('.quick-btn').forEach(btn => {
            btn.addEventListener('mouseenter', () => playSound('hover'));

            btn.addEventListener('click', function() {
                this.style.transform = 'scale(0.95)';
                setTimeout(() => {
                    this.style.transform = '';
                }, 150);
            });
        });

        // Ø§Ù„ØªØ£Ø«ÙŠØ±Ø§Øª Ø§Ù„ØµÙˆØªÙŠØ© Ù„Ù„Ø¥Ø¯Ø®Ø§Ù„
        document.getElementById('messageInput').addEventListener('focus', () => playSound('hover'));

        // Ø¥Ø¶Ø§ÙØ© ØªØ£Ø«ÙŠØ± Ø§Ù„Ù‡Ø² Ù„Ù„Ø£Ø®Ø·Ø§Ø¡
        const shakeKeyframes = `
            @keyframes shake {
                0%, 100% { transform: translateX(0); }
                25% { transform: translateX(-5px); }
                75% { transform: translateX(5px); }
            }
        `;

        const styleSheet = document.createElement('style');
        styleSheet.textContent = shakeKeyframes;
        document.head.appendChild(styleSheet);

        // Ø§Ù„ØªÙ‡ÙŠØ¦Ø© Ø¹Ù†Ø¯ Ø§Ù„ØªØ­Ù…ÙŠÙ„
        window.addEventListener('load', function() {
            createParticles();

            // ØµÙˆØª ØªØ±Ø­ÙŠØ¨ Ù…Ø¤Ø¬Ù„
            setTimeout(() => {
                playSound('notification');

                // Ø±Ø³Ø§Ù„Ø© ØªØ±Ø­ÙŠØ¨ Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠØ©
                const welcome = document.querySelector('.welcome-message h2');
                if (welcome) {
                    welcome.style.animation = 'titlePulse 2s ease-in-out infinite';
                }

            }, 1000);

            // ØªØ±ÙƒÙŠØ² ØªÙ„Ù‚Ø§Ø¦ÙŠ Ø¹Ù„Ù‰ Ø­Ù‚Ù„ Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„ (Ù„Ù„ÙƒÙ…Ø¨ÙŠÙˆØªØ± ÙÙ‚Ø·)
            if (window.innerWidth > 768) {
                document.getElementById('messageInput').focus();
            }
        });

        // Ø­ÙØ¸ ÙˆÙ‚Øª Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„Ø¬Ù„Ø³Ø©
        conversationStartTime = new Date();

        // ØªØ­Ø¯ÙŠØ« Ø¯ÙˆØ±ÙŠ Ù„Ù„Ø¬Ø²ÙŠØ¦Ø§Øª
        setInterval(() => {
            if (Math.random() > 0.7) { // 30% Ø§Ø­ØªÙ…Ø§Ù„
                const particles = document.querySelectorAll('.particle');
                if (particles.length > 0) {
                    const randomParticle = particles[Math.floor(Math.random() * particles.length)];
                    randomParticle.style.animationDuration = (Math.random() * 8 + 8) + 's';
                }
            }
        }, 3000);
    </script>
</body>
</html>